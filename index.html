<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>wasm-string</title>
        <script>
            let strLen;

            function stringExporter(instance) {
                return function getString(str) {
                    const pointer = instance.exports[str](false);
                    const buffer = new Uint8Array(
                        instance.exports.memory.buffer,
                        pointer,
                        strLen,
                    );
                    return String.fromCharCode(...buffer);
                }
            }

            fetch('main.wasm').then(response =>
                response.arrayBuffer()
            ).then(bytes =>
                WebAssembly.instantiate(bytes, { env: {
                    set_length: (num) => {strLen = num;},
                }})
            ).then(results => {
                const getString = stringExporter(results.instance);

                alert(getString('string_export'));
            });
        </script>
    </head>
</html>
